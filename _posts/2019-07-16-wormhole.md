---
layout: post
title: USACO training|1.4|Wormholes|wormhole|python
---

é¢˜ç›®å¤§æ„ï¼š æœ‰ä¸€å¤´ç‰›ğŸ®åªä¼šå‘+Xåæ ‡æ–¹å‘è¡Œèµ°ï¼Œåæ ‡å›¾ä¸­æœ‰ä¸€äº›è™«æ´ï¼Œ ä¸¤ä¸ªä¸€ç»„ã€‚ å¦‚æœğŸ®ä»ä¸€ç«¯æ´å£è¿›å»ï¼Œ å°±ä»å¦ä¸€ç«¯å‡ºæ¥ã€‚åŒç†ä»å¦ä¸€ç«¯è¿›å…¥ï¼Œ ä¹Ÿå¯ä»¥ä»è¿™ä¸€ç«¯
å‡ºæ¥ã€‚å‡è®¾æœ‰å››ä¸ªè™«æ´ï¼Œ åæ ‡åˆ†åˆ«ä¸ºAï¼ˆ0ï¼Œ 0ï¼‰ï¼Œ Bï¼ˆ1ï¼Œ 0ï¼‰ï¼Œ Cï¼ˆ1ï¼Œ 1ï¼‰ï¼Œ Dï¼ˆ0ï¼Œ 1ï¼‰ï¼Œ é‚£ä¹ˆç»è®¡ç®—å°±æœ‰ä¸¤ç§è¿æ¥æ–¹æ³•ä½¿ğŸ®å›°åœ¨è™«æ´å¾ªç¯ä¸­ã€‚è§£é‡Šä¸ºï¼šå¦‚æœ
Aå’ŒBç›¸è¿ï¼Œ Cå’ŒDç›¸è¿ï¼Œ ğŸ®è¿›å…¥Båä¼šä»Aå‡ºæ¥å†è¿›å…¥Bï¼Œå½¢æˆæ­»å¾ªç¯ã€‚å¦ä¸€ç§ä¸ºACç›¸è¿ï¼Œ BDç›¸è¿ï¼Œ è¿™æ ·ğŸ®è¿›å…¥Cåä¼šä»Aå‡ºæ¥å†è¿›å…¥Bï¼Œå†è¿›å…¥Dï¼Œ å†è¿›å…¥Cï¼Œå½¢æˆ
æ­»å¾ªç¯ï¼Œ å³è¿™ä¸¤ç§è¿æ¥æ–¹å¼ä¼šå½¢æˆæ­»å¾ªç¯ã€‚ä½†æ˜¯ADç›¸è¿ï¼Œ BCç›¸è¿å°±ä¸ä¼šå½¢æˆæ­»å¾ªç¯ï¼Œ ä¸¾ä¾‹å› ä¸ºğŸ®è¿›å…¥Bä¼šä»Cå‡ºæ¥ç»§ç»­å‘+xæ–¹å‘èµ°ï¼Œ æ°¸è¿œä¸ä¼šå¡åœ¨æ´é‡Œå½¢æˆæ­»å¾ªç¯ã€‚
æ‰€ä»¥å½¢æˆæ­»å¾ªç¯çš„è¿æ¥æ–¹å¼æœ‰ä¸¤ç§ã€‚æœ¬é¢˜é—®é¢˜æ˜¯ç»™å®šNä¸ªæ´åŠå…¶åæ ‡ï¼Œ é—®æœ‰å¤šå°‘ä¸­è¿æ¥æ–¹å¼ä½¿å…¶æˆä¸ºæ­»å¾ªç¯ã€‚

é¢˜ç›®è¯¦è§£ï¼šæ ¸å¿ƒæ€æƒ³æ˜¯æŠŠæ´åˆ†å¥½ç»„åï¼Œ å¯¹äºæ¯ä¸€ç§åˆ†ç»„ï¼Œ å¯¹äºå…¶ä¸­çš„æ¯ä¸€ä¸ªæ´ï¼Œ æ£€æµ‹è¿™ä¸ªæ´èƒ½èµ°çš„è·¯å¾„æ˜¯å¦æœ‰é—­ç¯ã€‚æ£€æµ‹æ–¹æ³•ä¸ºå¯¹ä»»ä½•ä¸€ä¸ªæ´ï¼Œ é¦–å…ˆæŸ¥çœ‹å®ƒå³è¾¹æœ‰æ²¡æœ‰
æ´ï¼Œ å¦‚æœæœ‰æ´ï¼Œ å¹¶ä¸”å³è¾¹çš„æ´å’Œè‡ªå·±ç›¸è¿ï¼Œ å°±æ˜¯å…¸å‹çš„é—­ç¯ç°è±¡ã€‚ ä½†å¦‚æœå³è¾¹çš„æ´å’Œç¬¬ä¸‰ä¸ªæ´ç›¸è¿ï¼Œ åˆ™æ£€æµ‹ç¬¬ä¸‰ä¸ªæ´å³è¾¹çš„æ´çš„ç›¸è¿æ´æ˜¯ä¸æ˜¯è‡ªå·±ï¼Œ å¦‚æœæ˜¯ï¼Œ 
å½¢æˆé—­ç¯ã€‚ å¦‚æœä¸€ç›´ä¸æ˜¯è‡ªå·±ï¼Œ æˆ–è€…æ²¡æœ‰å³è¾¹çš„æ´ï¼Œ å°±ä¸ä¼šå½¢æˆé—­ç¯ã€‚

ç®—æ³•ï¼šdfsï¼ˆæ·±åº¦ä¼˜å…ˆç®—æ³•ï¼‰

```python
"""
ID: whuan2001
LANG: PYTHON2
TASK: wormhole
"""
def solution():
    fin = open("wormhole.in", "r")
    fout = open("wormhole.out", "w")
    #è¯»å–è¾“å…¥æ•°æ®
    N = int(fin.readline().strip())
    points = []
    for l in fin.readlines():
        x, y = map(int, l.strip().split())
        points.append((x, y))
    #ç”¨sortedå‡½æ•°å’Œlambdaå‡½æ•°æŠŠçºµåæ ‡å…ˆæ’åºï¼Œ å†æŠŠæ¨ªåæ ‡ä»å°åˆ°å¤§æ’åº
    points = sorted(points, key = lambda x: (x[1], x[0]))
    right = {}
    #å¦‚æœå½“å‰ç‚¹å’Œä¸‹ä¸€ä¸ªç‚¹çš„çºµåæ ‡ç›¸ç­‰ï¼Œ æŠŠå½“å‰åæ ‡ä½œä¸ºå­—å…¸keyï¼Œä¸‹ä¸€åæ ‡ä½œä¸ºå­—å…¸çš„å€¼ï¼Œ å³æŠŠè‡ªå·±å’Œè‡ªå·±å³è¾¹çš„ç‚¹ç”¨å­—å…¸å½¢å¼å…³è”èµ·æ¥
    for h in range(len(points) - 1):
        if points[h][1] == points[h + 1][1]:
            right[points[h]] = points[h + 1]
    pairs = []
    #æŠŠè™«æ´è¿›è¡Œåˆ†ç»„
    pair_wormholes(points, {}, pairs)
    res = 0
    #å¯¹äºå·²ç»åˆ†å¥½ç»„çš„ï¼Œ å¦‚æœå…¶ä¸­æœ‰é—­ç¯ï¼Œ å³æ­»å¾ªç¯ï¼Œ å°±æ˜¯æˆ‘ä»¬æƒ³è¦æ±‚å¾—çš„ä¸€ç§æƒ…å†µ
    for pair in pairs:
        if has_circle(pair, right):
            res += 1
    print >>fout, res 
#å¯¹Nä¸ªè™«æ´è¿›è¡Œåˆ†ç»„ï¼Œ ä¸¤ä¸ªæ´ä¸€ç»„ï¼Œ æœ€åè‚¯å®šåˆ†å‡ºå¤šç§æƒ…å†µï¼Œ æ‰€ä»¥prefixè¡¨ç¤ºå½“å‰åˆ†å‡ºçš„æƒ…å†µï¼Œ ç„¶åæŠŠå·²ç»åˆ†å¥½çš„åŠ å…¥pairs
def pair_wormholes(points, prefix, pairs):
    #å½“å‰æƒ…å†µå…¨éƒ¨åˆ†å¥½ï¼Œ å°±åŠ å…¥pairsï¼Œ è¿”å›å½“å‰å‡½æ•°
    if len(prefix) == len(points):
        pairs.append(prefix)
        return
    #æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¾…åˆ†ç»„çš„æ´ï¼Œbreak
    for first in range(len(points)):
        if points[first] not in prefix:
            break
    #æ‰¾åˆ°ç¬¬äºŒä¸ªå¾…åˆ†ç»„çš„æ´ï¼Œ å¯èƒ½æœ‰å¤šä¸ªï¼Œ å³æŠŠprefixå¤åˆ¶å¥½ï¼Œ æŠŠè¿™ä¸¤ä¸ªæ´é…å¯¹åŠ å…¥æ–°çš„prefixï¼Œ å†æ¬¡è¿›è¡Œé€’å½’ã€‚çµæ„Ÿæ¥è‡ªå…«çš‡åé—®é¢˜ã€‚
    for second in range(first + 1, len(points)):
        if points[second] not in prefix:
            new_prefix = prefix.copy()        
            new_prefix[points[first]] = points[second]
            new_prefix[points[second]] = points[first]
            pair_wormholes(points, new_prefix, pairs)
#æ£€æµ‹å½“å‰åˆ†ç»„æ–¹æ³•æ˜¯å¦æœ‰é—­ç¯
def has_circle(pair, right):
    #å¯¹ä»»æ„ä¸€ä¸ªæ´æ¥è¯´ï¼Œ æ£€æµ‹å®ƒèƒ½èµ°çš„è·¯å¾„èƒ½å¦å½¢æˆé—­ç¯
    for p in pair:
        path = {}
        tag = 0
        #p in rightè¯´æ˜Pçš„å³è¾¹æœ‰æ´ï¼Œ å³ğŸ®å¯ä»¥å‘+Xæ–¹å‘èµ°åˆ°å³è¾¹ä¸‹ä¸€ä¸ªæ´
        while p in right:
            if p not in path:
                path[p] = True
            else:
                tag = 1
                break
            #På‘å³èµ°ä»¥åï¼Œ æŠŠå³è¾¹æ´çš„è¿æ¥æ´ç»™Pï¼Œ å¦‚æœæ–°çš„Pçš„ä¹‹å‰çš„Pç›¸åŒï¼Œ å³å·²ç»åœ¨pathé‡Œï¼Œ å°±è¯´æ˜æœ‰é—­ç¯ã€‚å¦‚æœæ˜¯pæ˜¯æ–°çš„æ´ï¼Œ å³å†æ¬¡æ£€æµ‹
            p = pair[right[p]]
        if tag == 1:
            return True
    return False    
if __name__ == "__main__":
    solution()
```
